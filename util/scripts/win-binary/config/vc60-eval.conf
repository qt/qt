#extracts the package to buildDir
extract     dest               "build_vc60_evaluation_________________PADDING_________________"
Section EXTRACT
extract     extUnpack          "qt-win-commercial-src-%QT_VERSION%.zip"
extract     extPatch           "qt-win-evalpatches-src-%QT_VERSION%.zip"
#delete line with "activeqt" in examples.pro file (don't build this)
delete      line               "build_vc60_evaluation_________________PADDING_________________\examples\examples.pro"  "activeqt"
SectionEnd

Section GETFILES
copy        extsync            addin60
copy        extsync            debugext
SectionEnd

#build the binaries
build       begin              vc60    "build_vc60_evaluation_________________PADDING_________________"

Section CONFIGURE
build       configure          "-confirm-license -plugin-sql-sqlite -plugin-sql-odbc -qt-libpng -qt-libjpeg -openssl -no-phonon -D QT_EVAL"
SectionEnd

Section BUILD
build       bin                sub-src
build       binInDir           "tools"
build       binInDir           "demos"                          release
build       binInDir           "examples"                       release
build		dbPlugins
SectionEnd

build       finish

# organize release files
Section ORGANIZE
delete      dir                "release_vc60_evaluation"

copy        dest               "release_vc60_evaluation"
copy        src                "build_vc60_evaluation_________________PADDING_________________"

# extract everything once more
extract     dest               "release_vc60_evaluation"
extract     unpack             "qt-win-commercial-src-%QT_VERSION%.zip"

# create header files
copy        syncqt

delete      destDir            "src"
delete      destDir            "tools"
delete      destDir            "qmake"

# phrasebooks & porting .xml file
copy        files              "tools\linguist\phrasebooks\*.qph"         "phrasebooks\"
copy        files              "tools\porting\src\*.xml"                  ""

# copying program database files
copy        files              "lib\*.pdb"             "bin\"
copy        files              "src\winmain\*.pdb"     "src\winmain\"

# qconfig.h
copy        files              "src\corelib\global\qconfig.h"             "include\Qt\"

# qconfig.pri
copy        file               "mkspecs\qconfig.pri"

# .qmake.cache
copy        file               ".qmake.cache"

# default mkspec
copy        files              "mkspecs\default\*"     "mkspecs\default\"

# copy all binary files
copy        all                "*.lib"
copy        all                "*.exe"
copy        all                "*.dll"

# .prl files
copy        files              "lib\*.prl"     "lib\"

# assistant help files
copy        all                "*.qch"

# remove unused stuff
delete      files              "lib\*.dll"
delete      file               "configure.exe"

# copy some activeqt stuff needed to compile examples
copy        file               "src\activeqt\control\qaxserver.rc"
copy        file               "src\activeqt\control\qaxserver.ico"
copy        file               "src\activeqt\control\qaxserver.def"
SectionEnd

Section NSIS
# general installer options
installer   begin              "Qt Evaluation"
installer   version            "%QT_VERSION%"
installer   output             "c:\iwmake\qt-win-eval-%QT_VERSION%-vc60.exe"
installer   startmenu          "Qt by Nokia v%QT_VERSION% (Eval. VC60)"

installer   enable             component_page
installer   enable             directory_page
installer   enable             startmenu_page

installer   instdir            msvc     0     "Qt v%QT_VERSION%:"
installer   instdir            addin    1     "Visual Studio Add-In:"

installer   runfunction        "Run Examples and Demos"
installer   readmefunction     "Show Documentation"

# license checking
installer   module             licensecheck
installer   defineDir          licensecheck    licenseDir   "release_vc60_evaluation"
installer   define             licensecheck    productlist  "UnsupportedEvaluation|SupportedEvaluation|FullSourceEvaluation"

installer   module             evaluation
installer   module             environment
installer   module             registeruiext

# msvc options
installer   module             msvc
installer   src                msvc     "release_vc60_evaluation"
installer   makeFileList       msvc     "release_vc60_evaluation"
installer   buildDir           msvc     "build_vc60_evaluation_________________PADDING_________________"
installer   define             msvc     vc60

# help options
installer   module             addin60

# debugext options
installer   module             debugext

# compile the package
installer   compile
installer   sign
SectionEnd
